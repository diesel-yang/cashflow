<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>極速記帳 v3.3</title>
  <style>
    :root { --teal:#1f8a84; --ink:#233; --muted:#6b7; --bg:#f5f7f8; }
    html,body{margin:0;padding:0;background:#ecf2f3;color:#223;font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang TC", "Noto Sans CJK TC", "Microsoft JhengHei", Arial, sans-serif;}
    .appbar{background:var(--teal); color:#fff; padding:12px 16px; position:sticky; top:0; z-index:10;}
    .appbar .title{font-weight:800; font-size:20px;}
    .monthbar{display:flex; gap:8px; align-items:center; margin-top:8px;}
    .chip{border:none; border-radius:12px; padding:8px 12px; background:#167a74; color:#fff; font-weight:700;}
    .chip.ghost{background:#0f6b66;}
    .chip:active{transform:scale(.98)}
    .container{padding:14px;}
    .tabs{display:flex; gap:8px; margin:8px 0 4px;}
    .tab{flex:1; background:#fff; border-radius:12px; padding:12px; text-align:center; font-weight:800; color:#3b6;}
    .tab.active{background:#1f8a84; color:#fff;}
    .view{display:none;}
    .view.active{display:block;}
    .card{background:#fff; border-radius:14px; padding:12px; margin:10px 0; box-shadow: 0 1px 0 rgba(0,0,0,.04);}
    .card.soft{background:#f9fbfb;}
    .card.tint{background:#eef6f6;}
    .row{display:flex; align-items:center; gap:8px; padding:6px 0;}
    .row.sm{padding:4px 0;}
    .row.head{font-weight:700}
    .w7{flex:0 0 7em}
    .w9{flex:0 0 9em}
    .flex1{flex:1}
    .ta-r{text-align:right}
    .mt6{margin-top:6px}
    .muted{color:#6c7a7a; font-size:12px}
    .toolbar{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .switch{display:flex; align-items:center; gap:6px}
    footer{color:#7c8; text-align:center; padding:16px 6px; font-size:12px}
    button.btn{background:#1f8a84; color:#fff; border:none; border-radius:12px; padding:10px 14px; font-weight:700}
    button.btn.ghost{background:#e7eeee; color:#1f8a84}
    input[type="checkbox"]{transform:scale(1.1)}
  </style>
</head>
<body>
  <div class="appbar">
    <div class="title">極速記帳 v3.3</div>
    <div class="monthbar">
      <button class="chip ghost" id="reportMonthPrev">‹</button>
      <span class="chip" id="reportMonthLabel">—</span>
      <button class="chip ghost" id="reportMonthNext">›</button>
    </div>
  </div>

  <div class="container">
    <!-- Tabs -->
    <div class="tabs">
      <div class="tab" id="tab-rec">記帳</div>
      <div class="tab" id="tab-trf">轉帳</div>
      <div class="tab active" id="tab-rep">報表</div>
      <div class="tab" id="tab-set">設定</div>
    </div>

    <!-- 記帳 -->
    <section class="view" id="view-rec">
      <div class="card">
        <div class="muted">（此處放你的記帳表單；保留原本欄位即可）</div>
      </div>
    </section>

    <!-- 轉帳 -->
    <section class="view" id="view-trf">
      <div class="card">
        <div class="muted">（此處放你的轉帳/還款表單；保留原本欄位與邏輯即可）</div>
      </div>
    </section>

    <!-- 報表 -->
    <section class="view active" id="view-rep">
      <div class="card">
        <div class="toolbar">
          <label class="switch">
            <input type="checkbox" id="rep-expand" />
            <span>明細展開</span>
          </label>
          <label class="switch">
            <input type="checkbox" id="rep-by-kind" />
            <span>按類型小計</span>
          </label>
          <button class="btn ghost" id="rep-refresh">重新整理</button>
        </div>
      </div>
      <div id="report-box"></div>
    </section>

    <!-- 設定 -->
    <section class="view" id="view-set">
      <div class="card">
        <div class="muted">（此處放共享代號 / 類別管理 / 預算 / 雲端同步設定等 UI）</div>
      </div>
    </section>

    <footer>極速記帳 v3.3 – build v17.x（P&L 版）</footer>
  </div>

  <!-- 你的主程式 -->
  <script src="app.js?v=pl-final"></script>
  <script>
    // 簡易頁籤切換（維持你原本也可）
    const views = {
      rec: document.getElementById('view-rec'),
      trf: document.getElementById('view-trf'),
      rep: document.getElementById('view-rep'),
      set: document.getElementById('view-set'),
    };
    const tabs = {
      rec: document.getElementById('tab-rec'),
      trf: document.getElementById('tab-trf'),
      rep: document.getElementById('tab-rep'),
      set: document.getElementById('tab-set'),
    };
    function activate(key){
      for (const k in views){ views[k].classList.toggle('active', k===key); }
      for (const k in tabs){ tabs[k].classList.toggle('active', k===key); }
      if (key==='rep' && typeof renderReport==='function'){ renderReport(); }
    }
    tabs.rec.onclick=()=>activate('rec');
    tabs.trf.onclick=()=>activate('trf');
    tabs.rep.onclick=()=>activate('rep');
    tabs.set.onclick=()=>activate('set');

    // 月份切換
    document.getElementById('reportMonthPrev').onclick = ()=> window.setReportMonthOffset && setReportMonthOffset(-1);
    document.getElementById('reportMonthNext').onclick = ()=> window.setReportMonthOffset && setReportMonthOffset(+1);

    // 報表控制
    document.getElementById('rep-expand').onchange = ()=> window.renderReport && renderReport();
    document.getElementById('rep-by-kind').onchange = ()=> window.renderReport && renderReport();
    document.getElementById('rep-refresh').onclick = ()=> window.renderReport && renderReport();

    // 首頁直接顯示報表
    document.addEventListener('DOMContentLoaded', ()=>{
      if (window.updateReportMonthLabel) updateReportMonthLabel();
      if (window.renderReport) renderReport();
    });
  </script>
</body>
</html>
