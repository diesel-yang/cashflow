<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>極速記帳 v3.3</title>

  <!-- 基礎樣式（行動優先） -->
  <style>
    :root{--c:#167c80;--bg:#f4f7f7;--card:#fff;--muted:#6b7280}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);font:16px/1.5 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans CJK TC", "PingFang TC","Microsoft JhengHei",sans-serif;color:#0f172a;}
    header{background:var(--c);color:#fff;padding:14px 16px;display:flex;align-items:center;gap:12px;position:sticky;top:0;z-index:10}
    header .brand{font-weight:800;font-size:18px;letter-spacing:.5px}
    main{padding:12px;max-width:900px;margin:0 auto}
    .tabs{display:flex;gap:10px;margin:8px 0 14px}
    .tab{flex:1;text-align:center;background:#eaf2f3;border-radius:12px;padding:10px 12px;font-weight:700;cursor:pointer}
    .tab.active{background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.06)}
    .section{display:none} .section.active{display:block}
    .card{background:var(--card);border-radius:14px;padding:12px 12px;margin:10px 0;box-shadow:0 1px 3px rgba(0,0,0,.05)}
    .row{display:flex;justify-content:space-between;align-items:center;gap:8px;padding:6px 0}
    .muted{color:var(--muted)}
    .btn{display:inline-block;border:none;background:var(--c);color:#fff;padding:12px 16px;border-radius:12px;font-weight:800;width:100%;cursor:pointer}
    .btn.secondary{background:#e8eff0;color:#0f172a}
    .pill{border-radius:999px;background:#eef6f6;padding:6px 10px;font-size:14px}
    input,select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #d0d7de;background:#fff}
    label{font-size:14px;color:#334155}
    .grid{display:grid;grid-template-columns:1fr;gap:10px}
    .controls{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .switches{display:flex;gap:16px;align-items:center}
    hr{border:none;border-top:1px solid #eef2f7;margin:8px 0}
    footer{padding:22px 0 36px;text-align:center;color:#94a3b8;font-size:13px}
    @media (min-width:720px){ .grid{grid-template-columns:1fr 1fr} }
  </style>
</head>

<body>
  <header>
    <div class="brand">極速記帳 v3.3</div>
  </header>

  <main>
    <!-- 導覽 -->
    <div class="tabs">
      <div class="tab active" data-tab="book">記帳</div>
      <div class="tab" data-tab="xfer">轉帳</div>
      <div class="tab" data-tab="report">報表</div>
      <div class="tab" data-tab="settings">設定</div>
    </div>

    <!-- 記帳 -->
    <section id="sec-book" class="section active">
      <div class="card">
        <div class="grid">
          <div>
            <label>對象（餐廳 / JACK / WAL）</label>
            <select id="owner">
              <option value="RESTAURANT">餐廳</option>
              <option value="JACK">JACK</option>
              <option value="WAL">WAL</option>
            </select>
          </div>
          <div>
            <label>類型</label>
            <select id="type">
              <option value="expense">支出</option>
              <option value="income">收入</option>
            </select>
          </div>
          <div>
            <label>分類</label>
            <select id="cat"></select>
          </div>
          <div>
            <label>金額</label>
            <input id="amt" type="number" inputmode="decimal" placeholder="金額" />
          </div>
          <div>
            <label>日期</label>
            <input id="date" type="date" />
          </div>
          <div>
            <label>備註（選填）</label>
            <input id="note" placeholder="說明 / 商家 / 關鍵字" />
          </div>
        </div>
        <div style="margin-top:10px"><button id="btn-add" class="btn">記錄</button></div>
      </div>

      <div class="card">
        <div class="row"><div class="muted">本月筆數</div><div id="count-this-month">0</div></div>
      </div>
    </section>

    <!-- 轉帳 -->
    <section id="sec-xfer" class="section">
      <div class="card">
        <div class="grid">
          <div>
            <label>用途</label>
            <select id="xfer-kind">
              <option value="transfer">轉帳（口袋間）</option>
              <option value="settle">還款（沖銷報銷）</option>
            </select>
          </div>
          <div>
            <label>From → To</label>
            <div class="controls">
              <select id="from">
                <option value="RESTAURANT_CASH">餐廳_現金</option>
                <option value="RESTAURANT_BANK">餐廳_銀行</option>
                <option value="JACK">JACK</option>
                <option value="WAL">WAL</option>
              </select>
              <select id="to">
                <option value="JACK">JACK</option>
                <option value="WAL">WAL</option>
                <option value="RESTAURANT_CASH">餐廳_現金</option>
                <option value="RESTAURANT_BANK">餐廳_銀行</option>
              </select>
            </div>
          </div>
          <div>
            <label>金額</label>
            <input id="xfer-amt" type="number" inputmode="decimal" />
          </div>
          <div>
            <label>日期</label>
            <input id="xfer-date" type="date" />
          </div>
        </div>
        <div style="margin-top:10px"><button id="btn-xfer" class="btn">建立轉帳</button></div>
      </div>

      <div class="card"><div id="xfer-list" class="muted">轉帳記錄（本月）</div></div>
    </section>

    <!-- 報表（P&L 可切月份與擁有者） -->
    <section id="sec-report" class="section">
      <div class="card">
        <div class="grid">
          <div>
            <label>月份</label>
            <input id="rep-month" type="month" />
          </div>
          <div>
            <label>對象</label>
            <select id="rep-owner">
              <option value="RESTAURANT">餐廳（Restaurant）</option>
              <option value="JACK">個人 P&L（JACK）</option>
              <option value="WAL">個人 P&L（WAL）</option>
            </select>
          </div>
        </div>
        <div class="switches" style="margin-top:8px">
          <label><input id="rep-by-kind" type="checkbox" /> 按類型小計</label>
          <label><input id="rep-expand" type="checkbox" /> 明細展開</label>
        </div>
      </div>

      <div id="report-box"></div>
    </section>

    <!-- 設定（示意：共享代號 + 分類管理 + 近超支門檻） -->
    <section id="sec-settings" class="section">
      <div class="card">
        <div class="row" style="gap:10px;align-items:end">
          <div style="flex:1">
            <label>共享空間（輸入代號，兩支手機一樣即可共用）</label>
            <input id="space-key" placeholder="例如 jackwal" />
          </div>
          <button id="btn-apply-space" class="btn" style="flex:0 0 160px">套用共享代號</button>
        </div>
        <div class="muted" style="margin-top:6px">同一個代號 = 同一份雲端資料（給 JACK 與 WAL 共用）。</div>
      </div>

      <div class="card">
        <div class="row" style="gap:10px">
          <div style="flex:1">
            <label>新分類（例：餐具耗材）</label>
            <input id="new-cat-label" />
          </div>
          <div style="flex:0 0 200px">
            <label>類別（Revenue/COGS/...）</label>
            <select id="new-cat-kind">
              <option value="revenue">revenue（營業收入）</option>
              <option value="cogs">cogs（銷貨成本）</option>
              <option value="personnel">personnel（人事費）</option>
              <option value="utilities">utilities（水電/租金/網路）</option>
              <option value="marketing">marketing（行銷）</option>
              <option value="logistics">logistics（物流）</option>
              <option value="admin">admin（行政/稅務/會計）</option>
            </select>
          </div>
          <button id="btn-add-cat" class="btn" style="flex:0 0 120px">新增</button>
        </div>
        <div id="cat-list" style="margin-top:10px"></div>
      </div>

      <div class="card">
        <label>近超支門檻（0~1，預設 0.9）</label>
        <input id="near-threshold" type="number" min="0" max="1" step="0.01" />
        <div style="margin-top:10px"><button id="btn-save-settings" class="btn">儲存設定</button></div>
      </div>
    </section>

    <footer>極速記帳 v3.3 — build v17.FB-P&L</footer>
  </main>

  <!-- 你的 Firebase CDN 初始化（保持你現有的 config） -->
  <script type="module" src="./app.js"></script>
</body>
</html>
