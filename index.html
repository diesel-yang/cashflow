<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>極速記帳</title>

  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css?v=3.6.0">
  <meta name="theme-color" content="#0a0f11">
</head>
<body>

  <!-- Topbar -->
  <header class="topbar">
    <div class="brand">
      <div class="logo">💨</div>
      <div>
        <div class="brand-name">極速記帳</div>
        <div class="brand-sub">雙夥伴／餐廳＋個人口袋</div>
      </div>
    </div>
    <div class="space"></div>
    <input id="space-code" class="input" style="max-width:200px" placeholder="共享代號">
    <button id="btn-connect" class="btn danger">未連線</button>
  </header>

  <!-- Tabs -->
  <nav class="tabs" role="tablist" aria-label="主功能">
    <button class="tab active" data-tab="rec">記帳</button>
    <button class="tab" data-tab="list">明細</button>
    <button class="tab" data-tab="stats">統計</button>
    <button class="tab" data-tab="settings">設定</button>
  </nav>

  <main>
    <!-- 記帳頁 -->
    <section id="page-rec" class="page show">
      <!-- 區塊 ①：支出/收入 + 金額 + 日期 -->
      <div class="card">
        <div class="row pack">
          <div class="chip-group" id="chip-io" role="group" aria-label="收支類型">
            <button class="chip pill lg" data-io="expense">支出</button>
            <button class="chip pill lg" data-io="income">收入</button>
          </div>

          <input id="rec-amt" type="number" inputmode="decimal" placeholder="金額" class="amt" aria-label="金額">
          <div class="date-wrap">
            <span class="i i-cal" aria-hidden="true">📅</span>
            <input id="rec-date" type="date" class="elevated" aria-label="日期">
          </div>
        </div>
      </div>

      <!-- 區塊 ②：付款口袋 + 付款人/收款人 -->
      <div class="card">
        <div class="row">
          <div class="subhead">付款口袋</div>
        </div>
        <div id="pockets-row" aria-label="付款口袋" class="grid grid-3">
          <!-- 動態注入（餐廳 / Jack / Wal） -->
        </div>

        <div class="row mt8">
          <div class="subhead">付款人</div>
        </div>
        <div id="payers-row" class="grid grid-3" aria-label="付款人或收款人">
          <!-- 動態注入（J / W / JW；或收入時 Jack / Wal） -->
        </div>
      </div>

      <!-- 區塊 ③：用途 / 分類大項 / 項目 -->
      <div class="card">
        <div class="row">
          <div class="subhead">用途</div>
        </div>
        <div class="chip-group" id="chip-scope" role="group" aria-label="用途">
          <button class="chip pill" data-scope="restaurant">餐廳</button>
          <button class="chip pill" data-scope="personal">個人</button>
        </div>

        <div class="row mt12">
          <div class="subhead">分類大項</div>
        </div>
        <div id="group-grid" class="chip-grid group-grid" aria-label="分類大項"></div>

        <div class="row mt12">
          <div class="subhead">項目</div>
        </div>
        <div id="items-grid" class="chip-grid items" aria-label="項目"></div>

        <div class="row mt12">
          <input id="new-cat-name" class="input flex" placeholder="新增項目（可用：🍕 漢堡）" aria-label="新增項目">
          <button id="btn-add-cat" class="btn">新增項目</button>
        </div>

        <div class="row mt8">
          <input id="rec-note" class="input flex" placeholder="備註（可省略）" aria-label="備註">
          <button id="btn-submit" class="btn">送出</button>
        </div>
      </div>

      <!-- 區塊 ④：最近 20 筆 -->
      <div class="card">
        <div class="section-head">最近 20 筆</div>
        <div id="recent-list" class="list"></div>
      </div>
    </section>

    <!-- 其餘頁（先保留骨架） -->
    <section id="page-list" class="page">
      <div class="card"><div class="section-head">所有明細（開發中）</div></div>
    </section>
    <section id="page-stats" class="page">
      <div class="card"><div class="section-head">統計圖表（開發中）</div></div>
    </section>
    <section id="page-settings" class="page">
      <div class="card"><div class="section-head">設定（開發中）</div></div>
    </section>
  </main>

  <footer class="foot">極速記帳 v3.6.0</footer>

  <!-- 小豬 ICON：SVG sprite（可依 CSS color 改色） -->
  <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
    <symbol id="pig-icon" viewBox="0 0 167.18021 139.17355">
      <g transform="translate(-51.916118,27.648844)">
        <path fill="currentColor" opacity="0.9"
          d="m 159.10807,111.35662 c -2.40703,-0.45785 -5.28801,-2.59846 -6.62113,-4.91958 -0.31892,-0.55528 -0.48678,-0.54145 -3.68,0.30329 -5.88076,1.5557 -9.92621,2.1046 -16.99142,2.30547 -8.95017,0.25446 -13.53618,-0.23659 -22.01817,-2.35761 -2.23157,-0.55803 -3.38245,-0.72004 -3.4601,-0.48708 -0.064,0.19199 -0.6081,0.99308 -1.20912,1.78021 -3.33694,4.37026 -10.658458,4.61317 -14.394716,0.47758 -1.970502,-2.18111 -2.489954,-3.75104 -2.64951,-8.00756 l -0.140126,-3.738197 -2.601336,-2.00118 c -3.354862,-2.58087 -8.479488,-7.74392 -10.92052,-11.00241 -1.054774,-1.408 -2.899737,-4.27378 -4.099917,-6.36839 -1.200179,-2.09461 -2.549176,-4.28959 -2.997769,-4.87773 -1.115154,-1.46204 -4.164019,-3.44027 -6.05868,-3.93112 -0.860448,-0.22291 -1.755727,-0.46304 -1.989509,-0.5336 -0.278999,-0.0842 -0.08441,-0.41494 0.566276,-0.96246 1.957937,-1.6475 3.520363,-5.22308 4.17794,-9.56114 0.823202,-5.43069 -1.416895,-14.014068 -4.448627,-17.045801 l -0.961051,-0.96105 2.625261,-0.143081 c 2.769672,-0.150952 4.420896,-0.74958 5.434434,-1.970176 0.313046,-0.376999 1.291821,-2.197453 2.175055,-4.045453 4.158669,-8.701224 11.320936,-16.881816 19.67645,-22.474029 1.648452,-1.1032842 3.002167,-2.0886852 3.008253,-2.1897812 0.0061,-0.101096 -1.064669,-1.324216 -2.379459,-2.718045 -3.014225,-3.195426 -3.101086,-3.136373 -3.995557,2.716396 -0.604717,3.9568262 -0.981342,5.5112912 -0.968851,3.9987932 0.01954,-2.366542 0.706491,-8.2689402 1.126356,-9.6778882 0.43313,-1.453459 0.67558,-1.774593 1.645856,-2.18000004 1.763206,-0.736714 6.08972,-0.54782 8.482405,0.37033904 0.395901,0.151922 0.529671,-0.21409604 0.705511,-1.93039304 0.462716,-4.51636996 1.439905,-5.45453696 5.634801,-5.40978996 8.41522,0.08977 18.65321,8.469193 21.32016,17.4497892 1.26852,4.271564 1.1073,9.785706 -0.38165,13.053338 -0.43324,0.9508 -0.72819,1.788258 -0.65543,1.861017 0.26839,0.268391 1.86416,-2.164031 2.50007,-3.810839 0.91456,-2.36844 1.11874,-6.79302 0.44559,-9.655665 -0.71968,-3.0604572 -2.99521,-7.2466362 -5.62577,-10.3494432 -1.22458,-1.44441104 -2.11162,-2.69720304 -1.97121,-2.78398204 0.37292,-0.230478 5.13606,-0.75376596 9.00824,-0.98966396 6.52712,-0.39764 17.41847,0.90586296 24,2.872379 25.14352,7.512706 42.27543,26.4103122 44.08664,48.6304092 0.23169,2.84238 0.24141,2.86766 1.35336,3.52 1.70787,1.00193 5.08958,0.90544 7.2,-0.20544 2.13267,-1.12259 3.78084,-2.89081 4.82413,-5.17549 0.71488,-1.565511 0.82757,-2.168625 0.67728,-3.624782 -0.29635,-2.871423 -1.69316,-4.212612 -3.94695,-3.789798 -1.86598,0.35006 -2.73143,3.01831 -1.38566,4.272088 0.69123,0.643972 2.65963,1.340481 3.78833,1.340481 0.83887,0 0.88121,0.68192 0.12287,1.979371 -0.49971,0.85496 -0.68918,0.94107 -1.7599,0.79983 -2.7199,-0.35878 -5.39082,-2.8257 -6.01866,-5.558973 -0.2282,-0.993409 -0.14843,-1.487813 0.42913,-2.659766 2.22784,-4.520613 9.77329,-4.353058 11.8343,0.262794 0.51067,1.143694 0.66075,2.100593 0.63624,4.056744 -0.10523,8.400251 -5.9679,14.579931 -15.79266,16.646641 -1.28281,0.26984 -2.37361,0.53185 -2.42399,0.58224 -0.0504,0.0504 -0.446,1.45049 -0.87913,3.11136 -3.047,11.68368 -10.72777,22.73171 -20.74533,29.8401 l -1.84,1.30565 v 3.304997 c 0,4.26329 -0.67908,6.33693 -2.77065,8.46043 -2.33026,2.36584 -5.54039,3.3971 -8.70238,2.79565 z M 74.533944,66.608113 c 3.728304,-1.48212 8.149681,-4.94956 10.802383,-8.4717 0.860628,-1.14271 1.771498,-2.08422 2.024154,-2.09226 0.252657,-0.008 0.792657,0.2985 1.2,0.68118 0.997071,0.9367 0.955519,0.13002 -0.04483,-0.87033 -1.062501,-1.0625 -1.901035,-0.99182 -2.671591,0.22519 -1.088767,1.71959 -4.280366,4.77161 -6.519333,6.23421 -3.452475,2.25534 -9.319594,4.27515 -12.418369,4.27515 -0.5021,0 -1.176685,0.10137 -1.49908,0.22527 -1.130341,0.43439 0.870217,0.71556 4.213828,0.59223 2.294095,-0.0846 3.684896,-0.3108 4.912838,-0.79894 z m 20.538319,-25.66578 c 2.494055,-1.194032 6.388837,-3.888125 6.388837,-4.419274 0,-0.169299 -0.55819,-0.475055 -1.24042,-0.679458 -1.191655,-0.357027 -1.3178,-0.319101 -3.207988,0.964501 -3.15236,2.140727 -5.749372,2.997932 -9.151586,3.020698 -2.424997,0.01623 -3.206163,-0.116298 -4.944485,-0.838837 -1.135466,-0.47196 -2.143466,-0.77708 -2.24,-0.678045 -0.249078,0.255533 1.8265,1.962105 3.344485,2.749887 2.054239,1.066079 2.717076,1.193147 5.771157,1.106353 2.564725,-0.07289 3.160874,-0.211291 5.28,-1.225825 z M 109.16202,24.029041 c 1.55148,-0.430996 3.77882,-2.403721 4.49552,-3.98163 2.05306,-4.520018 -1.18808,-10.2951592 -9.78775,-17.4400432 -3.5713,-2.96715504 -5.89069,-4.552068 -6.492011,-4.436206 -0.858319,0.16538 -1.093772,1.77686096 -1.136499,7.778391 -0.04428,6.2203222 0.318659,8.5608102 1.84474,11.8960462 2.113,4.61795 6.96353,7.325873 11.076,6.183442 z M 150.9011,3.7138648 c 0,-0.706393 -0.21081,-1.056728 -0.80816,-1.34303 -1.50496,-0.721308 -8.76724,-2.00585904 -13.50545,-2.38884004 -5.31032,-0.429224 -6.32639,-0.244615 -6.32639,1.14943904 0,1.116982 0.85221,1.458119 3.64258,1.458119 2.99627,0 8.86569,0.767524 12.03742,1.574092 1.32,0.335674 2.976,0.586825 3.68,0.558113 1.19596,-0.04878 1.28,-0.114958 1.28,-1.007893 z M 56.057097,67.204653 c -2.860593,-1.73963 -4.861443,-10.61642 -3.89483,-17.27946 0.813008,-5.604206 3.061241,-10.215641 4.980477,-10.215641 1.032705,0 2.503826,1.866519 3.652437,4.634113 3.112846,7.500448 2.468765,17.585908 -1.39629,21.864058 -1.407953,1.55844 -2.085902,1.76069 -3.341794,0.99693 z m 1.465009,-7.4151 c 1.137196,-2.12165 0.418587,-7.28 -1.014176,-7.28 -0.255211,0 -0.603786,0.52948 -0.789998,1.2 -0.700416,2.52208 -0.190255,7.12 0.789998,7.12 0.251207,0 0.707587,-0.468 1.014176,-1.04 z M 212.75271,46.335119 c 0.10154,-0.869742 0.38543,-1.201897 1.6208,-1.896331 0.82374,-0.463045 2.14146,-1.35132 2.92827,-1.973946 2.03708,-1.611995 2.46882,-0.946305 0.62465,0.963126 -1.79434,1.857833 -4.40163,3.961584 -4.90981,3.961584 -0.24928,0 -0.3432,-0.375241 -0.26391,-1.054433 z M 137.9411,-4.6229882 c -4.66191,-1.298183 -7.85876,-5.149786 -8.24252,-9.9307228 -0.40088,-4.994126 2.37865,-10.138493 6.59724,-12.210185 1.56781,-0.769929 2.18413,-0.886337 4.68528,-0.884933 2.25712,0.0013 3.19145,0.147413 4.32,0.675723 6.00968,2.813306 8.59937,10.500823 5.60153,16.628181 -2.2334,4.5649018 -7.99021,7.1062768 -12.96153,5.7219368 z m 6.78732,-1.993493 c 1.76813,-0.782128 3.72927,-2.672309 4.56994,-4.4045768 0.37329,-0.769207 0.66698,-2.191291 0.74535,-3.609043 0.1626,-2.941534 -0.47722,-4.752989 -2.40778,-6.816914 -4.55953,-4.874508 -12.31529,-3.631483 -15.18462,2.43366 -2.99084,6.32198 1.92927,13.6298698 8.86938,13.1737728 1.06677,-0.07011 2.60025,-0.419712 3.40773,-0.776899 z m -6.92133,-0.378669 c -4.20003,-1.69294 -6.28891,-6.2965668 -4.81706,-10.6162138 1.12237,-3.293961 4.36411,-5.534229 7.95547,-5.497779 2.30663,0.02341 3.78891,0.580688 5.46958,2.056337 1.72199,1.511921 2.719,3.797956 2.7229,6.24328 0.004,2.35002 -0.57138,3.850537 -2.14232,5.5893808 -2.34972,2.600855 -6.03947,3.494323 -9.18857,2.224995 z m 12.64353,-14.5275408 c -1.00098,-1.619614 -3.06267,-3.36401 -5.11111,-4.324502 -1.50103,-0.703815 -2.24818,-0.843253 -4.51841,-0.843253 -2.30775,0 -2.98674,0.131019 -4.48,0.864465 -0.968,0.475456 -2.336,1.483266 -3.04,2.239578 -1.10209,1.183987 -1.12433,1.233031 -0.16,0.35286 3.61154,-3.296338 9.61705,-3.832237 13.74479,-1.22651 1.26463,0.798329 3.85521,3.558769 3.85521,4.107993 0,0.180554 0.0884,0.239855 0.19651,0.131779 0.10807,-0.108076 -0.11107,-0.694161 -0.48699,-1.30241 z" />
      </g>
    </symbol>
  </svg>

  <!-- App -->
  <script type="module" src="app.js?v=52"></script>
  <script>
    // 簡易分頁切換
    document.querySelector('.tabs')?.addEventListener('click', e=>{
      const tab = e.target.closest('.tab'); if(!tab) return;
      document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
      tab.classList.add('active');
      const t = tab.dataset.tab;
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('show'));
      document.getElementById('page-'+t)?.classList.add('show');
    });

    // PWA 快速註冊
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('sw.js?ver=3.6.0').catch(console.warn);
    }
  </script>
</body>
</html>
